---
create by 千羽 2021-10-12
---

[TOC]

> GitHub：https://github.com/nateshao/ssm/tree/master/109-springmvc-json-restful
>

<center>欢迎关注千羽的公众号</center>

![程序员千羽](https://gitee.com/nateshao/images/raw/master/img/20211021102040.jpg)

## 1. 文件上传

**文件上传概述**

> 多数文件上传都是通过表单形式提交给后台服务器的，因此，要实现文件上传功能，就需要提供一个文件上传的表单，而该表单必须满足以下3个条件：

1. form表单的method属性设置为post；
2. form表单的enctype属性设置为multipart/form-data；
3. 提供< input type="file" name="filename" />的文件上传输入框。

**文件上传表单示例如下**

```html
   <form action="uploadUrl" method="post" enctype="multipart/form-data">

​     <input type="file" name="filename" multiple="multiple" />

​     <input type="submit" value="文件上传" />

   </form>
```

`multiple`属性是`HTML5`中新属性，可实现多文件上传

>    当`form`表单的`enctype`属性为`multipart/form-data`时，浏览器就会采用二进制流来处理表单数据，服务器端就会对文件上传的请求进行解析处理。Spring MVC通过`MultipartResolver`实现文件上传功能。`MultipartResolver`是一个接口对象，需要通过它的实现`CommonsMultipartResolver`来完成文件上传工作。

MultipartResolver配置示例如下:

```xml
<bean id="multipartResolver"          	     
     class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    设置请求编码格式，必须与JSP中的pageEncoding属性一致，默认为ISO-8859-1
    <property name="defaultEncoding" value="UTF-8" />
    设置允许上传文件的最大值（2M），单位为字节
    <property name="maxUploadSize" value="2097152" />
             ...
</bean>
```

>    在前面的配置代码中，除配置了`CommonsMultipartResolver`类外，还通过< property>元素配置了编码格式以及允许上传文件的大小。通过< property>元素可以对文件解析器类`CommonsMultipartResolver`的如下属性进行配置：

1. `maxUploadSize`：上传文件最大长度（以字节为单位）；
2. `maxInMemorySize`：缓存中的最大尺寸；
3. `defaultEncoding`：默认编码格式；
4. `resolveLazily`：推迟文件解析，以便在Controller中捕获文件大小异常。

  **注意**：因为`MultipartResolver`接口的实现类`CommonsMultipartResolver`内部是引用`multipartResolver`字符串获取该实现类对象并完成文件解析的，所以在配置`CommonsMultipartResolver`时必须指定该`Bean`的`id`为`multipartResolver`。

​     由于CommonsMultipartResolver是Spring MVC内部通过Apache Commons FileUpload技术实现的，所以Spirng MVC的文件上传还需要依赖Apache Commons FileUpload的组件，即需要导入支持文件上传的相关JAR包。

- commons-fileupload-1.3.2.jar
- lcommons-io-2.5.jar



当完成页面表单和文件上传解析器的配置后，在Controller中编写文件上传的方法即可实现文件上传，其代码如下所示：

```java
@Controller
public class FileUploadController {
       @RequestMapping("/fileUpload ")
       public String handleFormUpload(@RequestParam("name") String name,
                //使用MultipartFile 绑定接收上传文件                                 
                                      
@RequestParam("filename") MultipartFile file,...) {
	if (!file.isEmpty()) {// 判断上传文件是否为空，然后进行解析存放处理
		...
		return "uploadSuccess";
	}
	return "uploadFailure";
    }
}
```

​    在上述代码中，包含一个MultipartFile接口类型的参数file，上传到程序中的文件是被封装在该参数中的。

​    org.springframework.web.multipart.MultipartFile接口中提供了获取上传文件、文件名称等方法，如下表所示：

![](https://gitee.com/nateshao/images/raw/master/img/20211022170737.png)

代码实现：

























## 2. 文件下载

